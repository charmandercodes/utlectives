<!-- The new review (gets swapped into #review-list) -->
{% include 'a_reviews/detail_components/review.html' with reviews=reviews %}

<!-- The updated header (gets swapped out-of-band into #course-header) -->
<div id="course-header"
     class="flex items-center mb-5"
     hx-swap-oob="true">
    <p class="bg-blue-100 text-blue-800 text-sm font-semibold inline-flex items-center p-1.5 rounded-sm dark:bg-blue-200 dark:text-blue-800">
        {{ course.overall_rating }} / 5
    </p>
    <span class="w-1 h-1 mx-2 bg-gray-900 rounded-full dark:bg-gray-500"></span>
    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">{{ course.total_reviews }} reviews</p>

    {% if user.is_authenticated %}
        {% if user_review %}
            <!-- User has already reviewed - show edit button -->
            <a href="{% url 'user-page' %}" class="ms-auto">
                <button class="btn btn-primary mb-4 ms-auto" onclick="contact_modal.showModal()">
                    Your Reviews
                </button>
            </a>
        {% else %}
            <!-- User hasn't reviewed yet - show write review button -->
            <button class="btn btn-primary mb-4 ms-auto" onclick="contact_modal.showModal()">
                Write a Review
            </button>
        {% endif %}
    {% else %}
        <!-- User not logged in -->
        <a href="{% url 'account_signup' %}" class="ms-auto">
            <button type="button" class="mb-2 me-2 rounded-lg bg-orange-500 px-5 py-2.5 text-sm font-medium text-white hover:bg-primary-800 focus:outline-none focus:ring-4 focus:ring-primary-300">
                Login To Write a Review
            </button>
        </a>
    {% endif %}
</div>

<!-- The updated review bars (gets swapped out-of-band into #review-bars) -->
<div id="review-bars" class="gap-8 sm:grid sm:grid-cols-3" hx-swap-oob="true">
    <div>
        <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Enjoyment</dt>
            <dd class="flex items-center mb-3">
                <div class="w-full bg-gray-200 rounded-sm h-2.5 dark:bg-gray-700 me-2">
                    <div class="bg-blue-600 h-2.5 rounded-sm dark:bg-blue-500" style="width: {% widthratio course.enjoyment 5 100 %}%"></div>
                </div>
                <span class="text-sm font-medium text-gray-500 dark:text-gray-400">{{ course.enjoyment }}</span>
            </dd>
        </dl>
    </div>
    <div>
        <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Usefulness</dt>
            <dd class="flex items-center mb-3">
                <div class="w-full bg-gray-200 rounded-sm h-2.5 dark:bg-gray-700 me-2">
                    <div class="bg-blue-600 h-2.5 rounded-sm dark:bg-blue-500" style="width: {% widthratio course.usefullness 5 100 %}%"></div>
                </div>
                <span class="text-sm font-medium text-gray-500 dark:text-gray-400">{{ course.usefullness }}</span>
            </dd>
        </dl>
    </div>
    <div>
        <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Manageability</dt>
            <dd class="flex items-center mb-3">
                <div class="w-full bg-gray-200 rounded-sm h-2.5 dark:bg-gray-700 me-2">
                    <div class="bg-blue-600 h-2.5 rounded-sm dark:bg-blue-500" style="width: {% widthratio course.manageability 5 100 %}%"></div>
                </div>
                <span class="text-sm font-medium text-gray-500 dark:text-gray-400">{{ course.manageability }}</span>
            </dd>
        </dl>
    </div>
</div>
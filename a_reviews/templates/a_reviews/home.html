
{% extends 'base.html' %}

{% block title %} Home {% endblock %}

{% block content %}

    <div class="p-4 ml-16">
        <div class="p-4 rounded-lg dark:border-gray-700 mt-8">
      <!-- Default homepage content -->
            <div class="flex flex-col items-left justify-center h-48 mb-4 rounded-sm bg-gray-50 dark:bg-gray-900 dark:text-white">
                <p class="mb-4">Progsoc presents</p>
                <h1 class="mb-4 text-7xl font-bold font-sans text-orange-500">utlectives!</h1>
                <p>Your one-stop shop for UTS course and elective reviews</p>
            </div>

        <!-- HTMX Search and Filters Form -->
            <form id="filter-form">
                <div class="mb-6">
                    <div class="rounded-lg bg-gray-50 dark:bg-gray-800 p-6 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex items-center gap-3">
                            <input
                                type="text"
                                class="flex-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-3 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                placeholder="Search courses..."
                                name="search"
                                hx-get="{% url 'filter_courses' %}"
                                hx-trigger="keyup changed delay:500ms"
                                hx-target="#course-list"
                                hx-indicator="#search-indicator"
                                hx-include="#filter-form"
                                value="{{ request.GET.search }}"
                            />
                            
                            <!-- Hidden input for sort parameter -->
                            <input type="hidden" name="sort" id="sort-input" value="{{ request.GET.sort }}">
                            
                            <div id="search-indicator" class="htmx-indicator">
                                <svg class="animate-spin h-6 w-6 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                            </div>
                            
                            <!-- Sort Dropdown -->
                            <div class="dropdown">
                                <div tabindex="0" role="button" class="flex items-center gap-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-3 text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                    <span id="sort-text">Sort By</span>
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </div>
                                <ul tabindex="0" class="dropdown-content menu bg-base-100 rounded-box z-[1] w-52 p-2 shadow">
                                    <li><a onclick="setSortOption('Alphabetical (A-Z)', 'name')"
                                           hx-get="{% url 'filter_courses' %}?sort=name"
                                           hx-target="#course-list"
                                           hx-include="#filter-form">Alphabetical (A-Z)</a></li>
                                    <li><a onclick="setSortOption('Alphabetical (Z-A)', '-name')"
                                           hx-get="{% url 'filter_courses' %}?sort=-name"
                                           hx-target="#course-list"
                                           hx-include="#filter-form">Alphabetical (Z-A)</a></li>
                                    <li><a onclick="setSortOption('Overall Rating', '-overall_rating')"
                                           hx-get="{% url 'filter_courses' %}?sort=-overall_rating"
                                           hx-target="#course-list"
                                           hx-include="#filter-form">Overall Rating</a></li>
                                    <li><a onclick="setSortOption('Enjoyability', '-enjoyment')"
                                           hx-get="{% url 'filter_courses' %}?sort=-enjoyment"
                                           hx-target="#course-list"
                                           hx-include="#filter-form">Enjoyability</a></li>
                                    <li><a onclick="setSortOption('Usefulness', '-usefullness')"
                                           hx-get="{% url 'filter_courses' %}?sort=-usefullness"
                                           hx-target="#course-list"
                                           hx-include="#filter-form">Usefulness</a></li>
                                    <li><a onclick="setSortOption('Manageability', '-manageability')"
                                           hx-get="{% url 'filter_courses' %}?sort=-manageability"
                                           hx-target="#course-list"
                                           hx-include="#filter-form">Manageability</a></li>
                                </ul>
                            </div>
                            
                            <button type="button" onclick="filter_modal.showModal()" class="flex items-center gap-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-3 text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                Filter
                                <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M18.796 4H5.204a1 1 0 0 0-.753 1.659l5.302 6.058a1 1 0 0 1 .247.659v4.874a.5.5 0 0 0 .2.4l3 2.25a.5.5 0 0 0 .8-.4v-7.124a1 1 0 0 1 .247-.659l5.302-6.059c.566-.646.106-1.658-.753-1.658Z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                {% include 'a_reviews/partials/filter-modal.html' %}
            </form>

            <div id="course-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                {% include 'a_reviews/course_list.html' %}
            </div>
        </div>
    </div>

    <script>
        function setSortOption(displayText, sortValue) {
            // Update the button text
            document.getElementById('sort-text').textContent = displayText;
            
            // Update the hidden sort input
            document.getElementById('sort-input').value = sortValue;

            // Close the dropdown
            document.activeElement.blur();
        }
    </script>

{% endblock %}